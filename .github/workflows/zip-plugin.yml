# Nom du workflow
name: G√©n√©rer le Zip et cr√©er une PR sur le site web

# --- D√âCLENCHEUR ---
on:
  pull_request:
    branches:
      - main
    types: [opened, synchronize]

# --- T√ÇCHES (JOBS) ---
jobs:
  build-and-create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      # ... (les √©tapes 1 √† 4 ne changent pas) ...

      - name: 1. R√©cup√©ration du code de DIMA
        uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}

      - name: 2. Compression du r√©pertoire du plugin
        run: |
          cd "plugin/plugin_chrome/releases/"
          zip -r Plugin-dima.zip Plugin-dima

      - name: 3. R√©cup√©ration du d√©p√¥t M82-SiteWeb
        uses: actions/checkout@v4
        with:
          repository: M82-project/M82-SiteWeb
          token: ${{ secrets.CROSS_REPO_PAT }}
          path: M82-SiteWeb

      - name: 4. Copie du fichier .zip
        run: |
          mv plugin/plugin_chrome/releases/Plugin-dima.zip M82-SiteWeb/static/files/

      # √âtape 5 : Cr√©e une Pull Request dans M82-SiteWeb
      - name: 5. Cr√©ation de la Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          path: ./M82-SiteWeb
          token: ${{ secrets.CROSS_REPO_PAT }}
          # --- MODIFICATION ICI ---
          # On cr√©e un nom de branche unique pour chaque ex√©cution
          branch: "update/plugin-dima-${{ github.run_id }}"
          title: "ü§ñ Mise √† jour automatique du Plugin-dima.zip"
          body: |
            Mise √† jour du fichier `Plugin-dima.zip`.
            Cette modification a √©t√© d√©clench√©e automatiquement par un workflow du d√©p√¥t `DIMA`.
          commit-message: "feat: Mise √† jour du Plugin-dima.zip"
          base: master