# Nom du workflow
name: Mise √† jour du Zip dans les Pull Requests

# --- D√âCLENCHEUR ---
# Se d√©clenche quand une Pull Request est ouverte ou mise √† jour vers la branche main.
on:
  pull_request:
    branches:
      - main
    types: [opened, synchronize]

# --- T√ÇCHES (JOBS) ---
jobs:
  add-zip-to-pr:
    runs-on: ubuntu-latest
    # La permission d'√©crire est n√©cessaire pour commiter sur la branche de la PR.
    permissions:
      contents: write

    steps:
      # √âtape 1 : R√©cup√®re le code de la branche de la PR.
      # La 'ref' est cruciale pour r√©cup√©rer le code de la branche en cours et non 'main'.
      - name: 1. R√©cup√©ration du code de la Pull Request
        uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}

      # √âtape 2 : Cr√©e l'archive .zip √† partir des derniers changements.
      - name: 2. Compression du r√©pertoire du plugin
        run: |
          cd "plugin/plugin_chrome/releases/"
          zip -r Plugin-dima.zip Plugin-dima

      # √âtape 3 : Ajoute le commit avec le .zip √† la PR.
      # L'action commitera sur la branche actuellement r√©cup√©r√©e.
      - name: 3. Ajout du commit avec le .zip √† la PR
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ü§ñ CI : Ajout de l'archive Plugin-dima.zip mise √† jour"
          file_pattern: 'plugin/plugin_chrome/releases/Plugin-dima.zip'
